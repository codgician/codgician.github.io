{
  "hooks": {
    "PreToolUse": [
      {
        "name": "validate-haskell-edit",
        "description": "Check Haskell edits for common issues",
        "matcher": "tool == 'Edit' && tool_input.file_path matches '\\.hs$'",
        "hooks": [
          {
            "type": "command",
            "command": "#!/bin/bash\n# Check for unsafe functions in the new content\nif echo \"$TOOL_INPUT_NEW_STRING\" | grep -qE '(fromJust|head\\s|tail\\s|error\\s)'; then\n  echo '[Hook] Warning: Unsafe function detected. Use safe alternatives.' >&2\nfi"
          }
        ]
      }
    ],
    "SessionStart": [
      {
        "name": "load-session-memory",
        "description": "Load memory from previous session",
        "hooks": [
          {
            "type": "command",
            "command": "#!/bin/bash\nMEMORY_FILE=\".opencode/_memory/session-memory.md\"\nif [ -f \"$MEMORY_FILE\" ]; then\n  echo \"## Previous Session Context\"\n  cat \"$MEMORY_FILE\"\n  echo \"\"\n  echo \"---\"\nfi"
          }
        ]
      },
      {
        "name": "check-uncommitted-changes",
        "description": "Alert about uncommitted changes at session start",
        "hooks": [
          {
            "type": "command",
            "command": "#!/bin/bash\nCHANGES=$(git status --porcelain 2>/dev/null | wc -l | tr -d ' ')\nif [ \"$CHANGES\" -gt 0 ]; then\n  echo \"âš ï¸ $CHANGES uncommitted changes detected.\"\n  git status --short\nfi"
          }
        ]
      }
    ],
    "SessionEnd": [
      {
        "name": "save-session-memory",
        "description": "Persist session learnings for next time",
        "hooks": [
          {
            "type": "command",
            "command": "#!/bin/bash\nmkdir -p .opencode/_memory\nMEMORY_FILE=\".opencode/_memory/session-memory.md\"\necho \"# Session Memory\" > \"$MEMORY_FILE\"\necho \"\" >> \"$MEMORY_FILE\"\necho \"**Last Updated**: $(date -u +%Y-%m-%dT%H:%M:%SZ)\" >> \"$MEMORY_FILE\"\necho \"\" >> \"$MEMORY_FILE\"\necho \"## Recent Work\" >> \"$MEMORY_FILE\"\ngit log --oneline -5 2>/dev/null >> \"$MEMORY_FILE\" || echo \"(no git history)\" >> \"$MEMORY_FILE\"\necho \"\" >> \"$MEMORY_FILE\"\necho \"## Uncommitted Changes\" >> \"$MEMORY_FILE\"\ngit status --short 2>/dev/null >> \"$MEMORY_FILE\" || echo \"(no changes)\" >> \"$MEMORY_FILE\"\necho \"\" >> \"$MEMORY_FILE\"\necho \"Session memory saved to $MEMORY_FILE\""
          }
        ]
      }
    ],
    "OnError": [
      {
        "name": "build-error-analysis",
        "description": "Analyze build errors and suggest layer tracing",
        "matcher": "error.source == 'nix' || error.source == 'cabal'",
        "hooks": [
          {
            "type": "message",
            "message": "ðŸ”´ Build error detected. Consider: Is this an L1 implementation issue, or should we trace UP to L2 design?"
          }
        ]
      }
    ]
  },
  "settings": {
    "enableHooks": true,
    "memoryPersistence": true
  }
}
